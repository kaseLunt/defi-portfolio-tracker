# Minimal workers image
FROM node:22-alpine

WORKDIR /app

# Install OpenSSL for Prisma
RUN apk add --no-cache openssl

# Use minimal package.json for workers only
COPY workers.package.json ./package.json

# Install minimal deps
RUN npm install --legacy-peer-deps && npm cache clean --force

# Copy Prisma and generate
COPY prisma ./prisma
RUN npx prisma generate

# Copy source
COPY tsconfig.json ./
COPY src ./src

CMD ["npx", "tsx", "src/server/jobs/start-workers.ts"]
